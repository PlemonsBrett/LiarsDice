<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Liar&#x27;s Dice Documentation &raquo; Database System | Liar's
Dice</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon-dark.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">Liar's
Dice</a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="modules.html">Modules</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
            <li><a href="annotated.html">Classes</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="4">
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="index.html">Liar&#x27;s Dice Documentation</a> &raquo;</span>
          Database System
        </h1>
        <p>SQLite-based persistent storage for game data and statistics.</p>
        <nav class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li><a href="#database_overview">Overview</a></li>
            <li>
              <a href="#database_architecture">Architecture</a>
              <ul>
                <li><a href="#database_manager">Database Manager</a></li>
                <li><a href="#connection_pool">Connection Pool</a></li>
                <li><a href="#schema_manager">Schema Manager</a></li>
              </ul>
            </li>
            <li>
              <a href="#database_schema">Database Schema</a>
              <ul>
                <li><a href="#schema_tables">Core Tables (V001 - Initial Schema)</a></li>
                <li><a href="#schema_statistics">Statistics Tables (V002 - Statistics)</a></li>
              </ul>
            </li>
            <li>
              <a href="#database_operations">Common Operations</a>
              <ul>
                <li><a href="#db_save_game">Saving Game Data</a></li>
                <li><a href="#db_query_stats">Querying Statistics</a></li>
                <li><a href="#db_achievements">Achievement Tracking</a></li>
              </ul>
            </li>
            <li>
              <a href="#database_performance">Performance Considerations</a>
              <ul>
                <li><a href="#db_indexing">Indexing Strategy</a></li>
                <li><a href="#db_optimization">Query Optimization</a></li>
              </ul>
            </li>
            <li><a href="#database_error_handling">Error Handling</a></li>
            <li><a href="#database_testing">Testing Strategy</a></li>
          </ul>
        </nav>
<section id="database_overview"><h2><a href="#database_overview">Overview</a></h2><p>The Liar&#x27;s Dice database system provides persistent storage for game history, player statistics, AI behavior patterns, and performance metrics. Built on SQLite for portability and ease of deployment, the system includes connection pooling, schema versioning, and comprehensive error handling.</p></section><section id="database_architecture"><h2><a href="#database_architecture">Architecture</a></h2><p>The database system consists of several key components:</p><section id="database_manager"><h3><a href="#database_manager">Database Manager</a></h3><p>The <a href="classliarsdice_1_1database_1_1DatabaseManager.html" class="m-doc">liarsdice::<wbr />database::<wbr />DatabaseManager</a> class provides the main interface for database operations:</p><ul><li>Connection lifecycle management</li><li>Transaction support with RAII semantics</li><li>Prepared statement caching</li><li>Error handling and recovery</li></ul><pre class="m-code"><span class="c1">// Example usage</span>
<span class="n">DatabaseManager</span><span class="w"> </span><span class="n">db</span><span class="p">(</span><span class="s">&quot;game_data.db&quot;</span><span class="p">);</span>
<span class="n">db</span><span class="p">.</span><span class="n">initialize</span><span class="p">();</span>

<span class="k">auto</span><span class="w"> </span><span class="n">transaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">();</span>
<span class="n">db</span><span class="p">.</span><span class="n">saveGameSession</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
<span class="n">db</span><span class="p">.</span><span class="n">updatePlayerStatistics</span><span class="p">(</span><span class="n">playerId</span><span class="p">,</span><span class="w"> </span><span class="n">stats</span><span class="p">);</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">commit</span><span class="p">();</span></pre></section><section id="connection_pool"><h3><a href="#connection_pool">Connection Pool</a></h3><p>The connection pool (managed by <a href="classliarsdice_1_1database_1_1ConnectionPool.html" class="m-doc">liarsdice::<wbr />database::<wbr />ConnectionPool</a>) manages a pool of database connections for concurrent access:</p><ul><li>Thread-safe connection acquisition and release</li><li>Configurable pool size (default: 4 connections)</li><li>Automatic connection validation and recycling</li><li>Connection timeout handling</li></ul><pre class="m-code"><span class="n">ConnectionPool</span><span class="w"> </span><span class="n">pool</span><span class="p">(</span><span class="s">&quot;game_data.db&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pool</span><span class="p">.</span><span class="n">acquire</span><span class="p">();</span>
<span class="w">    </span><span class="n">conn</span><span class="o">-&gt;</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;INSERT INTO games ...&quot;</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// Connection automatically returned to pool</span></pre></section><section id="schema_manager"><h3><a href="#schema_manager">Schema Manager</a></h3><p>The <a href="classliarsdice_1_1database_1_1SchemaManager.html" class="m-doc">liarsdice::<wbr />database::<wbr />SchemaManager</a> handles database schema creation and migrations:</p><ul><li>Version tracking for schema upgrades</li><li>Automatic migration execution</li><li>Rollback support for failed migrations</li><li>Schema validation</li></ul></section></section><section id="database_schema"><h2><a href="#database_schema">Database Schema</a></h2><aside class="m-note m-info"><h4>Note</h4><p>Some fields in the schema are marked for future implementation and may not be actively used in the current version. These are maintained for forward compatibility.</p></aside><section id="schema_tables"><h3><a href="#schema_tables">Core Tables (V001 - Initial Schema)</a></h3><p><strong>players</strong> - Player account information</p><pre class="m-code"><span class="k">CREATE</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">players</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="nc">TEXT</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">display_name</span><span class="w"> </span><span class="nc">TEXT</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nc">TEXT</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_games</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">games_won</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">games_lost</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_points</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">highest_score</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="nc">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="nf">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">last_login</span><span class="w"> </span><span class="nc">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">is_active</span><span class="w"> </span><span class="k">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span>
<span class="p">);</span></pre><p><strong>game_history</strong> - Game session records</p><pre class="m-code"><span class="k">CREATE</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">game_history</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">game_uuid</span><span class="w"> </span><span class="nc">TEXT</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">started_at</span><span class="w"> </span><span class="nc">TIMESTAMP</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">ended_at</span><span class="w"> </span><span class="nc">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_players</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_rounds</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">winner_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">game_mode</span><span class="w"> </span><span class="nc">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;classic&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">is_completed</span><span class="w"> </span><span class="k">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">winner_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span></pre><p><strong>game_participants</strong> - Player participation in games</p><pre class="m-code"><span class="k">CREATE</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">game_participants</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">game_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">player_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">starting_position</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">final_position</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">points_scored</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">rounds_survived</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_guesses</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">successful_calls</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">bluffs_attempted</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">bluffs_caught</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">game_id</span><span class="p">,</span><span class="w"> </span><span class="n">player_id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">game_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">game_history</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">player_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span></pre><p><strong>achievements</strong> - Achievement definitions</p><pre class="m-code"><span class="k">CREATE</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">achievements</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">code</span><span class="w"> </span><span class="nc">TEXT</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nc">TEXT</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nc">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">points</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">icon_path</span><span class="w"> </span><span class="nc">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">category</span><span class="w"> </span><span class="nc">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;general&#39;</span>
<span class="p">);</span></pre><p><strong>player_achievements</strong> - Player earned achievements</p><pre class="m-code"><span class="k">CREATE</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">player_achievements</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">player_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">achievement_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">earned_at</span><span class="w"> </span><span class="nc">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="nf">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">game_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="n">achievement_id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">player_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">achievement_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">achievements</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">game_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">game_history</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span></pre></section><section id="schema_statistics"><h3><a href="#schema_statistics">Statistics Tables (V002 - Statistics)</a></h3><p><strong>game_rounds</strong> - Round-by-round game details</p><pre class="m-code"><span class="k">CREATE</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">game_rounds</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">game_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">round_number</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">starting_player_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">ending_player_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_dice</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">final_guess_count</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">final_guess_face</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">actual_count</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">liar_called</span><span class="w"> </span><span class="k">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">duration_seconds</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">game_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">game_history</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">starting_player_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">ending_player_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span></pre><p><strong>player_actions</strong> - Individual player actions</p><pre class="m-code"><span class="k">CREATE</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">player_actions</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">game_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">round_number</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">player_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">action_type</span><span class="w"> </span><span class="nc">TEXT</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="s1">&#39;guess&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;call_liar&#39;</span>
<span class="w">    </span><span class="n">action_timestamp</span><span class="w"> </span><span class="nc">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="nf">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">guess_count</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">guess_face</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">was_bluff</span><span class="w"> </span><span class="k">BOOLEAN</span><span class="p">,</span>
<span class="w">    </span><span class="n">was_correct</span><span class="w"> </span><span class="k">BOOLEAN</span><span class="p">,</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">game_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">game_history</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">player_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span></pre><p><strong>player_statistics</strong> - Aggregated player statistics</p><pre class="m-code"><span class="k">CREATE</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">player_statistics</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">player_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">avg_game_duration</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">avg_rounds_per_game</span><span class="w"> </span><span class="nc">REAL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">win_rate</span><span class="w"> </span><span class="nc">REAL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">favorite_dice_face</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">bluff_success_rate</span><span class="w"> </span><span class="nc">REAL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">call_accuracy_rate</span><span class="w"> </span><span class="nc">REAL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">most_played_hour</span><span class="w"> </span><span class="k">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">streak_current</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">streak_best</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">last_updated</span><span class="w"> </span><span class="nc">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="nf">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">player_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span></pre><p><strong>leaderboard_history</strong> - Historical leaderboard snapshots</p><pre class="m-code"><span class="k">CREATE</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">leaderboard_history</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">snapshot_date</span><span class="w"> </span><span class="nc">DATE</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="nf">rank</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">player_id</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">elo_rating</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="n">Player</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">ELO</span><span class="w"> </span><span class="n">rating</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="nc">time</span>
<span class="w">    </span><span class="n">games_played</span><span class="w"> </span><span class="k">INTEGER</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">win_rate</span><span class="w"> </span><span class="nc">REAL</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">snapshot_date</span><span class="p">,</span><span class="w"> </span><span class="nf">rank</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">player_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span></pre></section></section><section id="database_operations"><h2><a href="#database_operations">Common Operations</a></h2><section id="db_save_game"><h3><a href="#db_save_game">Saving Game Data</a></h3><pre class="m-code"><span class="kt">void</span><span class="w"> </span><span class="nf">saveGame</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Game</span><span class="o">&amp;</span><span class="w"> </span><span class="n">game</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DatabaseManager</span><span class="w"> </span><span class="n">db</span><span class="p">(</span><span class="s">&quot;game_data.db&quot;</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// Begin transaction for consistency</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">transaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">();</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Save game history record</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">gameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">saveGameHistory</span><span class="p">({</span>
<span class="w">            </span><span class="p">.</span><span class="n">gameUuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">getUuid</span><span class="p">(),</span>
<span class="w">            </span><span class="p">.</span><span class="n">startedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">getStartTime</span><span class="p">(),</span>
<span class="w">            </span><span class="p">.</span><span class="n">endedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">getEndTime</span><span class="p">(),</span>
<span class="w">            </span><span class="p">.</span><span class="n">totalPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">getPlayerCount</span><span class="p">(),</span>
<span class="w">            </span><span class="p">.</span><span class="n">totalRounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">getRoundCount</span><span class="p">(),</span>
<span class="w">            </span><span class="p">.</span><span class="n">winnerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">getWinner</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getId</span><span class="p">(),</span>
<span class="w">            </span><span class="p">.</span><span class="n">gameMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;classic&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">.</span><span class="n">isCompleted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span>
<span class="w">        </span><span class="c1">// Save participant details</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">getPlayers</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">db</span><span class="p">.</span><span class="n">saveGameParticipant</span><span class="p">(</span><span class="n">gameId</span><span class="p">,</span><span class="w"> </span><span class="n">player</span><span class="o">-&gt;</span><span class="n">getId</span><span class="p">(),</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="p">.</span><span class="n">startingPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="o">-&gt;</span><span class="n">getStartPosition</span><span class="p">(),</span>
<span class="w">                </span><span class="p">.</span><span class="n">finalPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="o">-&gt;</span><span class="n">getFinalPosition</span><span class="p">(),</span>
<span class="w">                </span><span class="p">.</span><span class="n">pointsScored</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="o">-&gt;</span><span class="n">getScore</span><span class="p">(),</span>
<span class="w">                </span><span class="p">.</span><span class="n">roundsSurvived</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="o">-&gt;</span><span class="n">getRoundsSurvived</span><span class="p">(),</span>
<span class="w">                </span><span class="p">.</span><span class="n">totalGuesses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="o">-&gt;</span><span class="n">getGuessCount</span><span class="p">(),</span>
<span class="w">                </span><span class="p">.</span><span class="n">successfulCalls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="o">-&gt;</span><span class="n">getSuccessfulCalls</span><span class="p">(),</span>
<span class="w">                </span><span class="p">.</span><span class="n">bluffsAttempted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="o">-&gt;</span><span class="n">getBluffCount</span><span class="p">(),</span>
<span class="w">                </span><span class="p">.</span><span class="n">bluffsCaught</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="o">-&gt;</span><span class="n">getBluffsCaught</span><span class="p">()</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span>
<span class="w">        </span><span class="c1">// Save round details (V002 schema)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">round</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">getRounds</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">db</span><span class="p">.</span><span class="n">saveGameRound</span><span class="p">(</span><span class="n">gameId</span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span>
<span class="w">        </span><span class="n">transaction</span><span class="p">.</span><span class="n">commit</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Transaction automatically rolls back</span>
<span class="w">        </span><span class="k">throw</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span></pre></section><section id="db_query_stats"><h3><a href="#db_query_stats">Querying Statistics</a></h3><pre class="m-code"><span class="n">PlayerStatistics</span><span class="w"> </span><span class="nf">getPlayerStats</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">username</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DatabaseManager</span><span class="w"> </span><span class="n">db</span><span class="p">(</span><span class="s">&quot;game_data.db&quot;</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">prepare</span><span class="p">(</span><span class="sa">R</span><span class="s">&quot;</span><span class="dl">(</span>
<span class="s">        SELECT </span>
<span class="s">            p.total_games,</span>
<span class="s">            p.games_won,</span>
<span class="s">            CAST(p.games_won AS REAL) / NULLIF(p.total_games, 0) as win_rate,</span>
<span class="s">            p.total_points,</span>
<span class="s">            p.highest_score,</span>
<span class="s">            ps.bluff_success_rate,</span>
<span class="s">            ps.call_accuracy_rate,</span>
<span class="s">            ps.avg_rounds_per_game,</span>
<span class="s">            ps.streak_current,</span>
<span class="s">            ps.streak_best</span>
<span class="s">        FROM players p</span>
<span class="s">        LEFT JOIN player_statistics ps ON p.id = ps.player_id</span>
<span class="s">        WHERE p.username = ?</span>
<span class="s">    </span><span class="dl">)</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">stmt</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stmt</span><span class="p">.</span><span class="n">step</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">.</span><span class="n">totalGames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<span class="w">            </span><span class="p">.</span><span class="n">gamesWon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="w">            </span><span class="p">.</span><span class="n">winRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
<span class="w">            </span><span class="p">.</span><span class="n">totalPoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
<span class="w">            </span><span class="p">.</span><span class="n">highestScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
<span class="w">            </span><span class="p">.</span><span class="n">bluffSuccessRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
<span class="w">            </span><span class="p">.</span><span class="n">callAccuracyRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
<span class="w">            </span><span class="p">.</span><span class="n">avgRoundsPerGame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
<span class="w">            </span><span class="p">.</span><span class="n">currentStreak</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
<span class="w">            </span><span class="p">.</span><span class="n">bestStreak</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Player not found&quot;</span><span class="p">);</span>
<span class="p">}</span></pre></section><section id="db_achievements"><h3><a href="#db_achievements">Achievement Tracking</a></h3><pre class="m-code"><span class="kt">void</span><span class="w"> </span><span class="nf">checkAndAwardAchievements</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">playerId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">gameId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DatabaseManager</span><span class="w"> </span><span class="n">db</span><span class="p">(</span><span class="s">&quot;game_data.db&quot;</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// Check for perfect game achievement</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">prepare</span><span class="p">(</span><span class="sa">R</span><span class="s">&quot;</span><span class="dl">(</span>
<span class="s">        SELECT points_scored </span>
<span class="s">        FROM game_participants </span>
<span class="s">        WHERE game_id = ? AND player_id = ?</span>
<span class="s">    </span><span class="dl">)</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">stmt</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">gameId</span><span class="p">);</span>
<span class="w">    </span><span class="n">stmt</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">playerId</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stmt</span><span class="p">.</span><span class="n">step</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">pointsScored</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span>
<span class="w">        </span><span class="c1">// Award perfect game achievement if applicable</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pointsScored</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// No points lost</span>
<span class="w">            </span><span class="n">db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">R</span><span class="s">&quot;</span><span class="dl">(</span>
<span class="s">                INSERT OR IGNORE INTO player_achievements </span>
<span class="s">                (player_id, achievement_id, game_id)</span>
<span class="s">                SELECT ?, id, ? FROM achievements </span>
<span class="s">                WHERE code = &#39;perfect_game&#39;</span>
<span class="s">            </span><span class="dl">)</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">playerId</span><span class="p">,</span><span class="w"> </span><span class="n">gameId</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span></pre></section></section><section id="database_performance"><h2><a href="#database_performance">Performance Considerations</a></h2><section id="db_indexing"><h3><a href="#db_indexing">Indexing Strategy</a></h3><p>Key indexes for optimal query performance (created by migrations):</p><pre class="m-code"><span class="o">--</span><span class="w"> </span><span class="n">Player</span><span class="w"> </span><span class="n">lookups</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_players_username</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_players_email</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_players_last_login</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">players</span><span class="p">(</span><span class="n">last_login</span><span class="p">);</span>

<span class="o">--</span><span class="w"> </span><span class="n">Game</span><span class="w"> </span><span class="n">history</span><span class="w"> </span><span class="n">queries</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_game_history_uuid</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">game_history</span><span class="p">(</span><span class="n">game_uuid</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_game_history_dates</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">game_history</span><span class="p">(</span><span class="n">started_at</span><span class="p">,</span><span class="w"> </span><span class="n">ended_at</span><span class="p">);</span>

<span class="o">--</span><span class="w"> </span><span class="nf">Round</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">action</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="p">(</span><span class="n">V002</span><span class="p">)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_game_rounds_game</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">game_rounds</span><span class="p">(</span><span class="n">game_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_player_actions_game</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">player_actions</span><span class="p">(</span><span class="n">game_id</span><span class="p">,</span><span class="w"> </span><span class="n">round_number</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_player_actions_player</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">player_actions</span><span class="p">(</span><span class="n">player_id</span><span class="p">);</span>

<span class="o">--</span><span class="w"> </span><span class="n">Leaderboard</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="p">(</span><span class="n">V002</span><span class="p">)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_leaderboard_date</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">leaderboard_history</span><span class="p">(</span><span class="n">snapshot_date</span><span class="p">);</span></pre></section><section id="db_optimization"><h3><a href="#db_optimization">Query Optimization</a></h3><ul><li>Use prepared statements for repeated queries</li><li>Batch inserts within transactions</li><li>Use connection pooling for concurrent access</li><li>Implement caching for frequently accessed statistics</li><li>Regular VACUUM operations for database maintenance</li></ul></section></section><section id="database_error_handling"><h2><a href="#database_error_handling">Error Handling</a></h2><p>The database system uses a comprehensive exception hierarchy:</p><pre class="m-code"><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">db</span><span class="p">.</span><span class="n">executeQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DatabaseConnectionError</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Handle connection failures</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DatabaseConstraintError</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Handle constraint violations</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DatabaseTimeoutError</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Handle timeout conditions</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DatabaseError</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Handle general database errors</span>
<span class="p">}</span></pre></section><section id="database_testing"><h2><a href="#database_testing">Testing Strategy</a></h2><p>Database testing includes:</p><ul><li>Unit tests for each database component</li><li>Integration tests for transaction handling</li><li>Performance benchmarks for query optimization</li><li>Stress tests for connection pooling</li><li>Migration tests for schema updates</li></ul><aside class="m-note m-default"><h4>See also</h4><p><a href="classliarsdice_1_1database_1_1DatabaseManager.html" class="m-doc">liarsdice::<wbr />database::<wbr />DatabaseManager</a></p><p><a href="classliarsdice_1_1database_1_1ConnectionPool.html" class="m-doc">liarsdice::<wbr />database::<wbr />ConnectionPool</a></p><p><a href="classliarsdice_1_1database_1_1SchemaManager.html" class="m-doc">liarsdice::<wbr />database::<wbr />SchemaManager</a></p><p><a href="classliarsdice_1_1database_1_1ConnectionManager.html" class="m-doc">liarsdice::<wbr />database::<wbr />ConnectionManager</a></p></aside></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim"></span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim"></span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v2.js"></script>
<script src="searchdata-v2.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Liar's
Dice. Created with <a href="https://doxygen.org/">Doxygen</a> 1.10.0 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
